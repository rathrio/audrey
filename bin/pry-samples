#!/usr/bin/env ruby

if ARGV.empty?
  puts "Usage: pry-samples <project ID>"
  exit
end

require 'bundler/inline'

gemfile do
  source 'https://rubygems.org'
  gem 'oj'
  gem 'pry'
  gem 'redis'
  gem 'hiredis'
end

require 'pry'
require 'redis'
require 'oj'

class Sample
  attr_reader :identifier, :meta_object, :value, :root_node_id, :category, :source

  def initialize(hash)
    @identifier = hash['identifier']
    @meta_object = hash.fetch('metaObject')
    @value = hash.fetch('value')
    @root_node_id = hash.fetch('rootNodeId')
    @category = hash.fetch('category')
    @source = hash.fetch('source')
    freeze
  end
end

project_id = ARGV.first
samples_key = "audrey:#{project_id}:samples"

redis = Redis.new(driver: :hiredis)
samples = redis
  .smembers(samples_key)
  .map { |sample_json| Sample.new(Oj.load(sample_json)) }

require 'pry'; binding.pry
puts 'Goodbye'
